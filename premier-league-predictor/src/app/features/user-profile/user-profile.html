<div
  class="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900"
>
  <div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="flex items-center justify-between mb-8">
      <h1 class="text-3xl font-bold text-white">User Profile</h1>
      <button
        (click)="authService.signOut()"
        class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors duration-200"
      >
        Sign Out
      </button>
    </div>

    <!-- Loading State -->
    @if (profileService.isLoading()) {
    <div class="flex items-center justify-center py-20">
      <div
        class="animate-spin rounded-full h-12 w-12 border-b-2 border-white"
      ></div>
    </div>
    }

    <!-- Error State -->
    @if (profileService.error()) {
    <div
      class="mb-6 p-4 bg-red-500/20 border border-red-500/30 rounded-xl backdrop-blur-sm"
    >
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-2">
          <svg
            class="w-5 h-5 text-red-300"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              fill-rule="evenodd"
              d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
              clip-rule="evenodd"
            />
          </svg>
          <span class="text-red-200">{{ profileService.error() }}</span>
        </div>
        <button
          (click)="profileService.clearError()"
          class="text-red-300 hover:text-red-100"
        >
          âœ•
        </button>
      </div>
    </div>
    }

    <!-- Profile Content -->
    @if (profileService.userProfile() && !profileService.isLoading()) {
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Profile Info Card -->
      <div class="lg:col-span-1">
        <div
          class="backdrop-blur-lg bg-white/10 border border-white/20 rounded-2xl p-6 shadow-xl"
        >
          <div class="text-center">
            <!-- Profile Photo -->
            <div class="relative w-24 h-24 mx-auto mb-4">
              @if (profileService.userProfile()?.photoURL) {
              <img
                [src]="profileService.userProfile()?.photoURL"
                [alt]="profileService.userProfile()?.displayName"
                class="w-24 h-24 rounded-full object-cover border-4 border-white/20"
              />
              } @else {
              <div
                class="w-24 h-24 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center border-4 border-white/20"
              >
                <span class="text-2xl font-bold text-white">
                  {{
                    getInitials(
                      profileService.userProfile()?.displayName || "A"
                    )
                  }}
                </span>
              </div>
              }
              <div
                class="absolute -bottom-1 -right-1 w-6 h-6 bg-green-500 rounded-full border-2 border-white/20"
              ></div>
            </div>

            <!-- Name and Email -->
            <div class="mb-4">
              @if (isEditingName()) {
              <div class="space-y-2">
                <input
                  [(ngModel)]="editedName"
                  (keyup.enter)="saveDisplayName()"
                  (keyup.escape)="cancelEdit()"
                  class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="Enter display name"
                  maxlength="50"
                />
                <div class="flex space-x-2">
                  <button
                    (click)="saveDisplayName()"
                    class="flex-1 px-3 py-1 bg-green-600 hover:bg-green-700 text-white rounded text-sm transition-colors"
                  >
                    Save
                  </button>
                  <button
                    (click)="cancelEdit()"
                    class="flex-1 px-3 py-1 bg-gray-600 hover:bg-gray-700 text-white rounded text-sm transition-colors"
                  >
                    Cancel
                  </button>
                </div>
              </div>
              } @else {
              <div class="group">
                <h2
                  class="text-xl font-bold text-white mb-1 flex items-center justify-center"
                >
                  {{ profileService.userProfile()?.displayName }}
                  <button
                    (click)="startEditingName()"
                    class="ml-2 opacity-0 group-hover:opacity-100 text-white/60 hover:text-white transition-all"
                  >
                    <svg
                      class="w-4 h-4"
                      fill="currentColor"
                      viewBox="0 0 20 20"
                    >
                      <path
                        d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"
                      />
                    </svg>
                  </button>
                </h2>
              </div>
              }
              <p class="text-white/70 text-sm">
                {{ profileService.userProfile()?.email }}
              </p>
            </div>

            <!-- Join Date -->
            <div class="text-center">
              <p class="text-white/60 text-xs">
                Member since
                {{ formatDate(profileService.userProfile()?.createdAt) }}
              </p>
            </div>
          </div>
        </div>

        <!-- Favorite Team Card -->
        <div
          class="mt-6 backdrop-blur-lg bg-white/10 border border-white/20 rounded-2xl p-6 shadow-xl"
        >
          <h3 class="text-lg font-semibold text-white mb-4">Favorite Team</h3>
          @if (isEditingTeam()) {
          <div class="space-y-3">
            <select
              [(ngModel)]="selectedTeam"
              class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              <option value="" class="bg-gray-800">Select a team</option>
              <option
                *ngFor="let team of premierLeagueTeams"
                [value]="team"
                class="bg-gray-800"
              >
                {{ team }}
              </option>
            </select>
            <div class="flex space-x-2">
              <button
                (click)="saveFavoriteTeam()"
                class="flex-1 px-3 py-2 bg-green-600 hover:bg-green-700 text-white rounded transition-colors text-sm"
              >
                Save
              </button>
              <button
                (click)="cancelTeamEdit()"
                class="flex-1 px-3 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded transition-colors text-sm"
              >
                Cancel
              </button>
            </div>
          </div>
          } @else {
          <div class="group cursor-pointer" (click)="startEditingTeam()">
            @if (profileService.userProfile()?.stats?.favoriteTeam) {
            <div
              class="flex items-center justify-between p-3 bg-white/5 rounded-lg border border-white/10 group-hover:border-white/20 transition-colors"
            >
              <span class="text-white font-medium">{{
                profileService.userProfile()?.stats?.favoriteTeam
              }}</span>
              <svg
                class="w-4 h-4 text-white/60 group-hover:text-white transition-colors"
                fill="currentColor"
                viewBox="0 0 20 20"
              >
                <path
                  d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"
                />
              </svg>
            </div>
            } @else {
            <div
              class="flex items-center justify-center p-4 border-2 border-dashed border-white/20 rounded-lg group-hover:border-white/40 transition-colors"
            >
              <span class="text-white/60 group-hover:text-white/80 text-sm"
                >Click to set favorite team</span
              >
            </div>
            }
          </div>
          }
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="lg:col-span-2">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
          <!-- Total Points -->
          <div
            class="backdrop-blur-lg bg-gradient-to-br from-yellow-500/20 to-orange-500/20 border border-yellow-500/30 rounded-2xl p-6 shadow-xl"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-yellow-200 text-sm font-medium">Total Points</p>
                <p class="text-3xl font-bold text-white">
                  {{
                    profileService.userProfile()?.stats?.totalPoints | number
                  }}
                </p>
              </div>
              <div
                class="w-12 h-12 bg-yellow-500/30 rounded-full flex items-center justify-center"
              >
                <svg
                  class="w-6 h-6 text-yellow-300"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                  />
                </svg>
              </div>
            </div>
          </div>

          <!-- Accuracy Rate -->
          <div
            class="backdrop-blur-lg bg-gradient-to-br from-green-500/20 to-emerald-500/20 border border-green-500/30 rounded-2xl p-6 shadow-xl"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-green-200 text-sm font-medium">Accuracy Rate</p>
                <p class="text-3xl font-bold text-white">
                  {{ profileService.accuracyPercentage() }}%
                </p>
                <p class="text-green-200 text-xs">
                  {{
                    profileService.userProfile()?.stats?.correctPredictions
                  }}
                  /
                  {{ profileService.userProfile()?.stats?.predictionsMade }}
                </p>
              </div>
              <div
                class="w-12 h-12 bg-green-500/30 rounded-full flex items-center justify-center"
              >
                <svg
                  class="w-6 h-6 text-green-300"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    fill-rule="evenodd"
                    d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                    clip-rule="evenodd"
                  />
                </svg>
              </div>
            </div>
          </div>

          <!-- Current Streak -->
          <div
            class="backdrop-blur-lg bg-gradient-to-br from-purple-500/20 to-pink-500/20 border border-purple-500/30 rounded-2xl p-6 shadow-xl"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-purple-200 text-sm font-medium">
                  Current Streak
                </p>
                <p class="text-3xl font-bold text-white">
                  {{ profileService.userProfile()?.stats?.currentStreak }}
                </p>
                <p class="text-purple-200 text-xs">
                  Best: {{ profileService.userProfile()?.stats?.longestStreak }}
                </p>
              </div>
              <div
                class="w-12 h-12 bg-purple-500/30 rounded-full flex items-center justify-center"
              >
                <svg
                  class="w-6 h-6 text-purple-300"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    fill-rule="evenodd"
                    d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z"
                    clip-rule="evenodd"
                  />
                </svg>
              </div>
            </div>
          </div>

          <!-- Perfect Weeks -->
          <div
            class="backdrop-blur-lg bg-gradient-to-br from-blue-500/20 to-cyan-500/20 border border-blue-500/30 rounded-2xl p-6 shadow-xl"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-blue-200 text-sm font-medium">Perfect Weeks</p>
                <p class="text-3xl font-bold text-white">
                  {{ profileService.userProfile()?.stats?.perfectWeeks }}
                </p>
                <p class="text-blue-200 text-xs">
                  Total Matches:
                  {{ profileService.userProfile()?.stats?.totalMatches }}
                </p>
              </div>
              <div
                class="w-12 h-12 bg-blue-500/30 rounded-full flex items-center justify-center"
              >
                <svg
                  class="w-6 h-6 text-blue-300"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                  />
                </svg>
              </div>
            </div>
          </div>
        </div>

        <!-- Preferences Section -->
        <div
          class="backdrop-blur-lg bg-white/10 border border-white/20 rounded-2xl p-6 shadow-xl"
        >
          <h3 class="text-xl font-bold text-white mb-6">Preferences</h3>

          <!-- Theme Selection -->
          <div class="mb-6">
            <label class="block text-white/80 text-sm font-medium mb-3"
              >Theme</label
            >
            <div class="grid grid-cols-3 gap-3">
              <button
                *ngFor="let theme of themes"
                (click)="updateTheme(theme.value)"
                [class]="getThemeButtonClass(theme.value)"
                class="p-3 rounded-lg border transition-all duration-200 text-sm font-medium"
              >
                <div class="flex items-center justify-center space-x-2">
                  <span [innerHTML]="theme.icon"></span>
                  <span>{{ theme.label }}</span>
                </div>
              </button>
            </div>
          </div>

          <!-- Notifications -->
          <div class="mb-6">
            <label class="block text-white/80 text-sm font-medium mb-3"
              >Notifications</label
            >
            <div class="space-y-3">
              <div class="flex items-center justify-between">
                <span class="text-white text-sm">Match Reminders</span>
                <button
                  (click)="toggleNotification('matchReminders')"
                  [class]="
                    getToggleClass(
                      profileService.userProfile()?.preferences?.notifications
                        ?.matchReminders
                    )
                  "
                  class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none"
                >
                  <span
                    [class]="
                      getToggleSpanClass(
                        profileService.userProfile()?.preferences?.notifications
                          ?.matchReminders
                      )
                    "
                    class="pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"
                  ></span>
                </button>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-white text-sm">Results Notifications</span>
                <button
                  (click)="toggleNotification('results')"
                  [class]="
                    getToggleClass(
                      profileService.userProfile()?.preferences?.notifications
                        ?.results
                    )
                  "
                  class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none"
                >
                  <span
                    [class]="
                      getToggleSpanClass(
                        profileService.userProfile()?.preferences?.notifications
                          ?.results
                      )
                    "
                    class="pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"
                  ></span>
                </button>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-white text-sm">Leaderboard Updates</span>
                <button
                  (click)="toggleNotification('leaderboard')"
                  [class]="
                    getToggleClass(
                      profileService.userProfile()?.preferences?.notifications
                        ?.leaderboard
                    )
                  "
                  class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none"
                >
                  <span
                    [class]="
                      getToggleSpanClass(
                        profileService.userProfile()?.preferences?.notifications
                          ?.leaderboard
                      )
                    "
                    class="pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"
                  ></span>
                </button>
              </div>
            </div>
          </div>

          <!-- Privacy Settings -->
          <div>
            <label class="block text-white/80 text-sm font-medium mb-3"
              >Privacy</label
            >
            <div class="space-y-3">
              <div class="flex items-center justify-between">
                <span class="text-white text-sm">Show Stats Publicly</span>
                <button
                  (click)="togglePrivacy('showStats')"
                  [class]="
                    getToggleClass(
                      profileService.userProfile()?.preferences?.privacy
                        ?.showStats
                    )
                  "
                  class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none"
                >
                  <span
                    [class]="
                      getToggleSpanClass(
                        profileService.userProfile()?.preferences?.privacy
                          ?.showStats
                      )
                    "
                    class="pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"
                  ></span>
                </button>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-white text-sm">Appear on Leaderboard</span>
                <button
                  (click)="togglePrivacy('showOnLeaderboard')"
                  [class]="
                    getToggleClass(
                      profileService.userProfile()?.preferences?.privacy
                        ?.showOnLeaderboard
                    )
                  "
                  class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none"
                >
                  <span
                    [class]="
                      getToggleSpanClass(
                        profileService.userProfile()?.preferences?.privacy
                          ?.showOnLeaderboard
                      )
                    "
                    class="pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"
                  ></span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    }
  </div>
</div>
